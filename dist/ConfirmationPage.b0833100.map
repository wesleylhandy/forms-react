{"version":3,"sources":["src/Components/helpers/scrollToPoint.js","src/Components/PaymentForm.js","src/Components/Spinner.js","src/Components/ConfirmationPage.js"],"names":["scrollToPoint","top","docHeight","document","documentElement","scrollHeight","winHeight","window","innerHeight","speed","initialPoint","scrollY","pageYOffset","scrollDown","requestAnimationFrame","winScroll","timestamp","scroll","cancelAnimationFrame","offsetTop","el","rect","getBoundingClientRect","scrollTop","PaymentForm","props","state","formAction","cssConfig","formData","lifetime","cookie","localStorage","setItem","forms","hiddenform","submit","click","target","getElementById","keys","Object","inputs","map","k","i","JSON","stringify","Component","Spinner","handleUnload","e","returnValue","ConfirmationPage","mode","ready","getGlobals","bind","handleMessage","reRenderForm","renderReceiptPage","addEventListener","url","devServicesUri","preProdServicesUri","prodServicesUri","devReceiptUri","preProdReceiptUri","prodReceiptUri","setState","console","error","data","parse","type","origin","isOrigin","tracking_vars","hydrateForm","varsArray","nextProps","nextState","removeEventListener"],"mappings":"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","file":"ConfirmationPage.b0833100.map","sourceRoot":"..","sourcesContent":["/**\n * Function to scroll to a particular point on the DOM\n * @param {Number} top - pageYoffset of form\n */\nexport function scrollToPoint(top) {\n    const docHeight = document.documentElement.scrollHeight;\n    const winHeight = window.innerHeight;\n    const speed = 40;\n    const initialPoint = window.scrollY ? window.scrollY : window.pageYOffset;\n    const scrollDown = top >= initialPoint;\n\n    if (scrollDown) {\n        top = top > docHeight - winHeight ? docHeight - winHeight : top;\n    } else {\n        top = docHeight <= winHeight ? 0 : top;\n    }\n\n    window.requestAnimationFrame(winScroll);\n\n    function winScroll(timestamp) {\n        let scroll = window.scrollY ? window.scrollY : window.pageYOffset;\n        if (scrollDown) {\n            if (scroll >= top) {\n                return window.cancelAnimationFrame(timestamp);\n            }\n            scroll += speed;\n        } else {\n           \n            if (scroll <= top) {\n                return window.cancelAnimationFrame(timestamp);\n            }\n            scroll -= speed;\n        }\n        window.scroll(0, scroll);\n        window.requestAnimationFrame(winScroll);\n    }\n}\n\n/**\n * \n * @param {Node} el - DOM Element\n * @returns {Number} - integer representing offsetTop of the element relative to the viewport\n */\nexport function offsetTop (el) {\n    const rect = el.getBoundingClientRect(),\n    scrollTop = window.scrollY ? window.scrollY : window.pageYOffset;\n    return rect.top + scrollTop;\n}","import React, {Component} from 'react';\n\nimport styles from './styles/payment-form.module.css'\n\nimport {crypt} from './helpers/crypt'\nimport {scrollToPoint, offsetTop} from './helpers/scrollToPoint'\n\nclass PaymentForm extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            formAction: props.formAction,\n            cssConfig: props.cssConfig\n        }\n    }\n    componentDidMount() {\n        const {formData} = this.props;\n        const lifetime = 60 * 1000; // 60 seconds * 1000 milliseconds\n        const cookie = crypt({formData, lifetime})\n        localStorage.setItem(\"store\", cookie);\n\n        document.forms.hiddenform.submit.click();\n        \n        // scroll to top of form\n        const target = document.getElementById('react-form-top');\n        const top = offsetTop(target);\n        // console.log({top})\n        scrollToPoint(top);\n    }\n    render() {\n        const {formData} = this.props;\n        const keys = Object.keys(formData)\n        const inputs = keys.map((k,i)=><input key={i + \"-\" + k} name={k} value={formData[k] ? formData[k] : ''} type=\"hidden\"/>)\n        // console.log(JSON.stringify(this.props.cssConfig))\n        return (\n            <React.Fragment>\n                <form id=\"hiddenform\" styleName=\"styles.hidden\" action={this.state.formAction} method=\"POST\" target=\"paymentprocess\">\n                    {inputs}\n                    <input type='hidden' name=\"cssVars\" value={JSON.stringify(this.state.cssConfig)}/> \n                    <input id=\"submit\" type=\"submit\" hidden/>\n                </form>\n                <iframe styleName=\"styles.form-panel\" name=\"paymentprocess\" width=\"100%\" height=\"1000px\"></iframe>\n            </React.Fragment>\n        )\n    }\n}\n\nexport default PaymentForm","import React from 'react'\nimport styles from './styles/spinner.module.css'\n\nfunction Spinner () {\n    return (\n        <div styleName=\"styles.loading_spinner\">\n            <img styleName=\"styles.loading_spinner__flames\" src=\"//www1.cbn.com/sites/all/themes/cbn_default/images/spinner/cbn-flame-circle.png\"/>\n            <img styleName=\"styles.loading_spinner__back\" src=\"//www1.cbn.com/sites/all/themes/cbn_default/images/spinner/loader-spinner@3x.png\"/>\n        </div>\n    )\n}\n\nexport default Spinner","import React, { Component } from 'react'\n\nimport PaymentForm from './PaymentForm'\nimport Spinner from './Spinner'\n\nimport {callApi} from './helpers/fetch-helpers'\n\nfunction handleUnload(e){\n    e.returnValue = \"Are you sure you want to go back?\\n You may lose all your changes to this page.\"\n    return \"Are you sure you want to go back?\\n You may lose all your changes to this page.\"\n}\n\nfunction handleUnload(e){\n    e.returnValue = \"Are you sure you want to go back?\\n You may lose all your changes to this page.\"\n    return \"Are you sure you want to go back?\\n You may lose all your changes to this page.\"\n}\n\nclass ConfirmationPage extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            mode: props.mode,\n            cssConfig: props.cssConfig,\n            formData: props.formData,\n            formAction: props.formAction,\n            ready: false\n        }\n        this.getGlobals = this.getGlobals.bind(this)\n        this.handleMessage = this.handleMessage.bind(this)\n        this.reRenderForm = this.reRenderForm.bind(this)\n        this.renderReceiptPage = this.renderReceiptPage.bind(this)\n    }\n\n    componentDidMount() {\n\n        window.addEventListener('beforeunload', handleUnload)\n        window.addEventListener('message', this.handleMessage, false)   \n        this.getGlobals();\n        \n    }\n\n    async getGlobals() {\n        const url = this.state.mode == \"development\" ? 'http://securegiving.cbn.local/UI/globals/form-config.json' : 'https://securegiving.cbn.com/UI/globals/form-config.json'\n        try {\n            const {devServicesUri,preProdServicesUri,prodServicesUri,devReceiptUri,preProdReceiptUri,prodReceiptUri} = await callApi(url)\n            this.setState({ready: true, devServicesUri, devReceiptUri, preProdServicesUri, preProdReceiptUri, prodServicesUri, prodReceiptUri})\n        } catch (err) {\n            console.error(err);\n        }\n    }\n\n    handleMessage(e) {\n        const data = e.data ? JSON.parse(e.data) : {}\n        if (data.type !== \"go back clicked\" && data.type !==\"render receipt\") {\n            return;\n        } \n        const {origin} = e;\n        const isOrigin = this.state.mode == \"development\" ? origin == this.state.devServicesUri || origin == this.state.preProdServicesUri : origin == this.state.prodServicesUri;\n        if (!isOrigin) {\n            return\n        }\n        if (data.type === \"go back clicked\") {\n            this.reRenderForm(this.state.formData);\n        } else if (data.type === \"render receipt\") {\n            // console.log('Render Receipt')\n            // console.log({tracking_vars:data.tracking_vars})\n            this.renderReceiptPage(data.tracking_vars);\n        }\n        return;\n    }\n\n    reRenderForm(data) {\n        this.props.hydrateForm(data);\n    }\n\n    renderReceiptPage(varsArray) {\n        this.props.renderReceiptPage(varsArray);\n    }\n\n    shouldComponentUpdate(nextProps, nextState) {\n        if (this.state.ready !== nextState.ready) {\n            return true\n        }\n        return false\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener('beforeunload', handleUnload)\n        window.removeEventListener('message', this.handleMessage)\n    }\n\n    render() {\n\n        return ( \n            <React.Fragment>\n            { this.state.ready ? (\n                    <PaymentForm cssConfig={this.state.cssConfig} formAction={this.state.formAction} formData={this.state.formData}  />                \n                ) : (\n                    <Spinner />\n                )\n            }\n            </React.Fragment>\n        )\n    }\n}\n\nexport default ConfirmationPage"]}